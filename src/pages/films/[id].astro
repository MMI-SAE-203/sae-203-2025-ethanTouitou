---
import { getFilms } from "../../../backend/backend.mjs"; // Assure-toi que cette fonction existe
import Layout from "../../layouts/Layout.astro"; // Importe le layout
export async function getStaticPaths() {
    const films = await getFilms(); // Appelle la fonction pour récupérer les films

    return films.map((film) => ({
        params: { id: film.id.toString() }, // Génère les chemins dynamiques avec l'ID
    }));
}

const { id } = Astro.params; // Récupère l'ID du film dans l'URL
const films = await getFilms(); // Récupère à nouveau les films ici

const film = films.find((f) => f.id.toString() === id); // Recherche le film par ID

if (!film) {
    throw new Error("Film not found"); // Si le film n'est pas trouvé
}
---

<Layout>
    <section class="py-16">
        <div class="container mx-auto px-6">
            <!-- Film details -->
            <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                <!-- Affichage de l'image avec l'URL de PocketBase -->
                <img
                    src={`http://127.0.0.1:8090/api/files/films/${film.id}/${film.affiche}`}
                    alt={film.titreFilm}
                    class="w-full h-64 object-cover"
                />

                <div class="p-6">
                    <h3 class="text-3xl font-bold text-blue-900 mb-4">
                        {film.titreFilm}
                    </h3>
                    <p class="text-gray-700 mb-6">
                        {film.synopsis}
                    </p>
                    <div class="mt-4 text-gray-500">
                        <p><strong>Durée:</strong> {film.duree} minutes</p>
                        <p>
                            <strong>Année de sortie:</strong>
                            {film.annee_sortie}
                        </p>
                        <p><strong>Réalisateur:</strong> {film.production}</p>
                    </div>
                </div>
                <iframe
                    width="560"
                    height="315"
                    src={film.bandeannonce}
                    title="YouTube video player"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin"
                    allowfullscreen></iframe>
            </div>
        </div>
    </section>
    <Layout />
</Layout>
